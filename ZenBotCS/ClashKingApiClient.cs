using CocApi.Rest.Models;
using Discord.WebSocket;
using Microsoft.EntityFrameworkCore.Storage;
using Newtonsoft.Json;
using System;
using System.CodeDom;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Net.Http.Headers;
using System.Text;
using System.Threading.Tasks;
using System.Web;
using ZenBotCS.Models.ClashKingApi;

namespace ZenBotCS
{


    public class ClashKingApiClient
    {
        private readonly HttpClient _httpClient;

        private const string HostUrl = "api.clashking.xyz";

        private const string testJson = "[\r\n  {\r\n    \"state\": \"warEnded\",\r\n    \"teamSize\": 25,\r\n    \"attacksPerMember\": 2,\r\n    \"preparationStartTime\": \"20231230T042422.000Z\",\r\n    \"startTime\": \"20231231T032422.000Z\",\r\n    \"endTime\": \"20240101T032422.000Z\",\r\n    \"clan\": {\r\n      \"tag\": \"#2G2LJUYGV\",\r\n      \"name\": \"Zen Seekers\",\r\n      \"badgeUrls\": {\r\n        \"small\": \"https://api-assets.clashofclans.com/badges/70/8WhutCWKrbciJps9ktkcdEoYIo0QLnFN3AHPnpGP0hA.png\",\r\n        \"large\": \"https://api-assets.clashofclans.com/badges/512/8WhutCWKrbciJps9ktkcdEoYIo0QLnFN3AHPnpGP0hA.png\",\r\n        \"medium\": \"https://api-assets.clashofclans.com/badges/200/8WhutCWKrbciJps9ktkcdEoYIo0QLnFN3AHPnpGP0hA.png\"\r\n      },\r\n      \"clanLevel\": 7,\r\n      \"attacks\": 45,\r\n      \"stars\": 75,\r\n      \"destructionPercentage\": 100,\r\n      \"members\": [\r\n        {\r\n          \"tag\": \"#QJVLQ0CCC\",\r\n          \"name\": \"Yikz\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 18,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#QJVLQ0CCC\",\r\n              \"defenderTag\": \"#QRLCR292Y\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 30,\r\n              \"duration\": 106\r\n            },\r\n            {\r\n              \"attackerTag\": \"#QJVLQ0CCC\",\r\n              \"defenderTag\": \"#LLCCURULC\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 31,\r\n              \"duration\": 150\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#8G2PJJPQ9\",\r\n          \"name\": \"Green Arrow\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 8,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#8G2PJJPQ9\",\r\n              \"defenderTag\": \"#G0GRYRVRL\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 12,\r\n              \"duration\": 144\r\n            },\r\n            {\r\n              \"attackerTag\": \"#8G2PJJPQ9\",\r\n              \"defenderTag\": \"#2PVJPR0L\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 14,\r\n              \"duration\": 121\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GYRY8QR2J\",\r\n            \"defenderTag\": \"#8G2PJJPQ9\",\r\n            \"stars\": 2,\r\n            \"destructionPercentage\": 76,\r\n            \"order\": 3,\r\n            \"duration\": 103\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#29R0VGQU\",\r\n          \"name\": \"FlameArcher\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 7,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#29R0VGQU\",\r\n              \"defenderTag\": \"#QU8U998QR\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 51,\r\n              \"duration\": 124\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#2UV2VU2V2\",\r\n          \"name\": \"ObeyLil'Momo\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 16,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GYRY8QR2J\",\r\n            \"defenderTag\": \"#2UV2VU2V2\",\r\n            \"stars\": 2,\r\n            \"destructionPercentage\": 73,\r\n            \"order\": 7,\r\n            \"duration\": 81\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#PLG98LLQ\",\r\n          \"name\": \"ᴹᴬˢˢᴵᵛᴱǝʞıɯ\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 9,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#PLG98LLQ\",\r\n              \"defenderTag\": \"#G0GRYRVRL\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 41,\r\n              \"duration\": 127\r\n            },\r\n            {\r\n              \"attackerTag\": \"#PLG98LLQ\",\r\n              \"defenderTag\": \"#Y90U2U829\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 42,\r\n              \"duration\": 136\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G8GQR0GY9\",\r\n          \"name\": \"Cuba III\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 14,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G8GQR0GY9\",\r\n              \"defenderTag\": \"#2PVJPR0L\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 45,\r\n              \"duration\": 109\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G8GQR0GY9\",\r\n              \"defenderTag\": \"#G0GRYRVRL\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 46,\r\n              \"duration\": 90\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GUV292VJ\",\r\n          \"name\": \"TA15\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 6,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GUV292VJ\",\r\n              \"defenderTag\": \"#2PVJPR0L\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 39,\r\n              \"duration\": 99\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GUV292VJ\",\r\n              \"defenderTag\": \"#LUQPQJ2G0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 44,\r\n              \"duration\": 117\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LJCV2UU29\",\r\n            \"defenderTag\": \"#GUV292VJ\",\r\n            \"stars\": 2,\r\n            \"destructionPercentage\": 66,\r\n            \"order\": 17,\r\n            \"duration\": 100\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GP9UVLUJ2\",\r\n          \"name\": \"Yaspox\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 21,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GP9UVLUJ2\",\r\n              \"defenderTag\": \"#G99YLCG89\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 10,\r\n              \"duration\": 84\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GP9UVLUJ2\",\r\n              \"defenderTag\": \"#G8UGGYYPJ\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 21,\r\n              \"duration\": 107\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G9CLPP0R8\",\r\n          \"name\": \"SertQuos\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 20,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9CLPP0R8\",\r\n              \"defenderTag\": \"#GLPJV9RCG\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 1,\r\n              \"duration\": 59\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9CLPP0R8\",\r\n              \"defenderTag\": \"#QRLCR292Y\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 2,\r\n              \"duration\": 109\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LJCV2UU29\",\r\n            \"defenderTag\": \"#G9CLPP0R8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 36,\r\n            \"duration\": 144\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#LV89GV88Y\",\r\n          \"name\": \"Warrior₩Th9\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 10,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#LV89GV88Y\",\r\n              \"defenderTag\": \"#G9C88Q8J0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 18,\r\n              \"duration\": 108\r\n            },\r\n            {\r\n              \"attackerTag\": \"#LV89GV88Y\",\r\n              \"defenderTag\": \"#G8QYUYL2Q\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 19,\r\n              \"duration\": 76\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#QJV89QJPJ\",\r\n          \"name\": \"FlorisHussie\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 1,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#QJV89QJPJ\",\r\n              \"defenderTag\": \"#LUQPQJ2G0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 34,\r\n              \"duration\": 112\r\n            },\r\n            {\r\n              \"attackerTag\": \"#QJV89QJPJ\",\r\n              \"defenderTag\": \"#Q9YCGUUQP\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 35,\r\n              \"duration\": 132\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#QLPG2LJ8P\",\r\n          \"name\": \"Warrior\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 15,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#QLPG2LJ8P\",\r\n              \"defenderTag\": \"#Q9Y89CRU8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 15,\r\n              \"duration\": 137\r\n            },\r\n            {\r\n              \"attackerTag\": \"#QLPG2LJ8P\",\r\n              \"defenderTag\": \"#Q9YCGUUQP\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 77,\r\n              \"order\": 16,\r\n              \"duration\": 118\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GPGLJPQ0U\",\r\n          \"name\": \"LagApprentice⚡\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 25,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GPGLJPQ0U\",\r\n              \"defenderTag\": \"#GYC9G9L90\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 37,\r\n              \"duration\": 169\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GPGLJPQ0U\",\r\n              \"defenderTag\": \"#QVRY0PG9V\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 38,\r\n              \"duration\": 75\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#Y90U2U829\",\r\n            \"defenderTag\": \"#GPGLJPQ0U\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 52,\r\n            \"duration\": 59\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GY9JQCJ8U\",\r\n          \"name\": \"MagicWhistle1\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 24,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GY9JQCJ8U\",\r\n              \"defenderTag\": \"#QVRY0PG9V\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 4,\r\n              \"duration\": 106\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GY9JQCJ8U\",\r\n              \"defenderTag\": \"#GY8RQ0QC2\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 5,\r\n              \"duration\": 141\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QVRY0PG9V\",\r\n            \"defenderTag\": \"#GY9JQCJ8U\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 32,\r\n            \"duration\": 112\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#YPQ2UJUQR\",\r\n          \"name\": \"BumblinMumbler2\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 19,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#YPQ2UJUQR\",\r\n              \"defenderTag\": \"#G8QYUYL2Q\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 49,\r\n              \"duration\": 84\r\n            },\r\n            {\r\n              \"attackerTag\": \"#YPQ2UJUQR\",\r\n              \"defenderTag\": \"#G9C88Q8J0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 50,\r\n              \"duration\": 84\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G9QPLQ00J\",\r\n          \"name\": \"Electric Wizard\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 11,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9QPLQ00J\",\r\n              \"defenderTag\": \"#Q2UGCURGC\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 6,\r\n              \"duration\": 129\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9QPLQ00J\",\r\n              \"defenderTag\": \"#LLCCURULC\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 93,\r\n              \"order\": 29,\r\n              \"duration\": 180\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#2UCYLQJ0Y\",\r\n          \"name\": \":mike:\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 2,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#2UCYLQJ0Y\",\r\n              \"defenderTag\": \"#Q9YCGUUQP\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 40,\r\n              \"duration\": 151\r\n            },\r\n            {\r\n              \"attackerTag\": \"#2UCYLQJ0Y\",\r\n              \"defenderTag\": \"#2PVJPR0L\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 43,\r\n              \"duration\": 124\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GYQRJGGCQ\",\r\n          \"name\": \"Kijanii\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 4,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GYQRJGGCQ\",\r\n              \"defenderTag\": \"#QU8U998QR\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 25,\r\n              \"duration\": 126\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GYQRJGGCQ\",\r\n              \"defenderTag\": \"#LJCV2UU29\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 26,\r\n              \"duration\": 153\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G80YGVYPP\",\r\n          \"name\": \"Deusloveswar\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 5,\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GLYYCU2JG\",\r\n          \"name\": \"asgaR0R\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 17,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GLYYCU2JG\",\r\n              \"defenderTag\": \"#QV8YUP2Y0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 9,\r\n              \"duration\": 120\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GLYYCU2JG\",\r\n              \"defenderTag\": \"#Y90U2U829\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 20,\r\n              \"duration\": 103\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#P200GRQJ\",\r\n          \"name\": \"firebird 2.0\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 3,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#P200GRQJ\",\r\n              \"defenderTag\": \"#Q9YCGUUQP\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 24,\r\n              \"duration\": 118\r\n            },\r\n            {\r\n              \"attackerTag\": \"#P200GRQJ\",\r\n              \"defenderTag\": \"#LUQPQJ2G0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 28,\r\n              \"duration\": 125\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G9YV2GJV8\",\r\n          \"name\": \"ShinE\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 22,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9YV2GJV8\",\r\n              \"defenderTag\": \"#QV9UUCJP2\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 13,\r\n              \"duration\": 77\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9YV2GJV8\",\r\n              \"defenderTag\": \"#G8Y902PGL\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 27,\r\n              \"duration\": 64\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#Y90U2U829\",\r\n            \"defenderTag\": \"#G9YV2GJV8\",\r\n            \"stars\": 2,\r\n            \"destructionPercentage\": 86,\r\n            \"order\": 53,\r\n            \"duration\": 100\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#9CJVUYQPY\",\r\n          \"name\": \"red mastachio\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 12,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#9CJVUYQPY\",\r\n              \"defenderTag\": \"#G2GQC0Y90\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 22,\r\n              \"duration\": 70\r\n            },\r\n            {\r\n              \"attackerTag\": \"#9CJVUYQPY\",\r\n              \"defenderTag\": \"#GYC9G9L90\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 23,\r\n              \"duration\": 59\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G08UGPLLY\",\r\n          \"name\": \"Ryan\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 13,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G08UGPLLY\",\r\n              \"defenderTag\": \"#GYRY8QR2J\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 8,\r\n              \"duration\": 91\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G08UGPLLY\",\r\n              \"defenderTag\": \"#G0YGLG0V8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 11,\r\n              \"duration\": 148\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G9Y8JQP80\",\r\n          \"name\": \"treehunter\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 23,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9Y8JQP80\",\r\n              \"defenderTag\": \"#Q9YCGUUQP\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 62,\r\n              \"order\": 47,\r\n              \"duration\": 116\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9Y8JQP80\",\r\n              \"defenderTag\": \"#Q2UGCURGC\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 48,\r\n              \"duration\": 121\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QVRY0PG9V\",\r\n            \"defenderTag\": \"#G9Y8JQP80\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 33,\r\n            \"duration\": 144\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    \"opponent\": {\r\n      \"tag\": \"#2G98P289G\",\r\n      \"name\": \"klan kita semua\",\r\n      \"badgeUrls\": {\r\n        \"small\": \"https://api-assets.clashofclans.com/badges/70/TTPFmAOkvBsMgcp1lsejcJXKkHW5WY9MQDSrOGESekU.png\",\r\n        \"large\": \"https://api-assets.clashofclans.com/badges/512/TTPFmAOkvBsMgcp1lsejcJXKkHW5WY9MQDSrOGESekU.png\",\r\n        \"medium\": \"https://api-assets.clashofclans.com/badges/200/TTPFmAOkvBsMgcp1lsejcJXKkHW5WY9MQDSrOGESekU.png\"\r\n      },\r\n      \"clanLevel\": 6,\r\n      \"attacks\": 8,\r\n      \"stars\": 20,\r\n      \"destructionPercentage\": 28.04,\r\n      \"members\": [\r\n        {\r\n          \"tag\": \"#QV8YUP2Y0\",\r\n          \"name\": \"banting exe 3\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 15,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GLYYCU2JG\",\r\n            \"defenderTag\": \"#QV8YUP2Y0\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 9,\r\n            \"duration\": 120\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#LJCV2UU29\",\r\n          \"name\": \"MON PRANK\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 6,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#LJCV2UU29\",\r\n              \"defenderTag\": \"#GUV292VJ\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 66,\r\n              \"order\": 17,\r\n              \"duration\": 100\r\n            },\r\n            {\r\n              \"attackerTag\": \"#LJCV2UU29\",\r\n              \"defenderTag\": \"#G9CLPP0R8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 36,\r\n              \"duration\": 144\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GYQRJGGCQ\",\r\n            \"defenderTag\": \"#LJCV2UU29\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 26,\r\n            \"duration\": 153\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#LUQPQJ2G0\",\r\n          \"name\": \"sdoct\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 2,\r\n          \"opponentAttacks\": 3,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#P200GRQJ\",\r\n            \"defenderTag\": \"#LUQPQJ2G0\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 28,\r\n            \"duration\": 125\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#Q9YCGUUQP\",\r\n          \"name\": \"REZA\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 3,\r\n          \"opponentAttacks\": 5,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#P200GRQJ\",\r\n            \"defenderTag\": \"#Q9YCGUUQP\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 24,\r\n            \"duration\": 118\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G0YGLG0V8\",\r\n          \"name\": \"karep\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 13,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G08UGPLLY\",\r\n            \"defenderTag\": \"#G0YGLG0V8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 11,\r\n            \"duration\": 148\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G8Y902PGL\",\r\n          \"name\": \"Zarch YB\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 17,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9YV2GJV8\",\r\n            \"defenderTag\": \"#G8Y902PGL\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 27,\r\n            \"duration\": 64\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G0GRYRVRL\",\r\n          \"name\": \"Jarot96\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 5,\r\n          \"opponentAttacks\": 3,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#8G2PJJPQ9\",\r\n            \"defenderTag\": \"#G0GRYRVRL\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 12,\r\n            \"duration\": 144\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G8QYUYL2Q\",\r\n          \"name\": \"erfan\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 19,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LV89GV88Y\",\r\n            \"defenderTag\": \"#G8QYUYL2Q\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 19,\r\n            \"duration\": 76\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#Q9Y89CRU8\",\r\n          \"name\": \"jhaya#95\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 7,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QLPG2LJ8P\",\r\n            \"defenderTag\": \"#Q9Y89CRU8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 15,\r\n            \"duration\": 137\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#LLCCURULC\",\r\n          \"name\": \"Ryan\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 8,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QJVLQ0CCC\",\r\n            \"defenderTag\": \"#LLCCURULC\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 31,\r\n            \"duration\": 150\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G99YLCG89\",\r\n          \"name\": \"ALVARO\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 21,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GP9UVLUJ2\",\r\n            \"defenderTag\": \"#G99YLCG89\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 10,\r\n            \"duration\": 84\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G8UGGYYPJ\",\r\n          \"name\": \"bunjut\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 14,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GP9UVLUJ2\",\r\n            \"defenderTag\": \"#G8UGGYYPJ\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 21,\r\n            \"duration\": 107\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#Q2UGCURGC\",\r\n          \"name\": \"keane\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 10,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9QPLQ00J\",\r\n            \"defenderTag\": \"#Q2UGCURGC\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 6,\r\n            \"duration\": 129\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G9C88Q8J0\",\r\n          \"name\": \"farid\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 18,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LV89GV88Y\",\r\n            \"defenderTag\": \"#G9C88Q8J0\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 18,\r\n            \"duration\": 108\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GLPJV9RCG\",\r\n          \"name\": \"ahmaD Gofar\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 20,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9CLPP0R8\",\r\n            \"defenderTag\": \"#GLPJV9RCG\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 1,\r\n            \"duration\": 59\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GYRY8QR2J\",\r\n          \"name\": \"janda baru\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 9,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GYRY8QR2J\",\r\n              \"defenderTag\": \"#8G2PJJPQ9\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 76,\r\n              \"order\": 3,\r\n              \"duration\": 103\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GYRY8QR2J\",\r\n              \"defenderTag\": \"#2UV2VU2V2\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 73,\r\n              \"order\": 7,\r\n              \"duration\": 81\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G08UGPLLY\",\r\n            \"defenderTag\": \"#GYRY8QR2J\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 8,\r\n            \"duration\": 91\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QRLCR292Y\",\r\n          \"name\": \"shadow\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 11,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9CLPP0R8\",\r\n            \"defenderTag\": \"#QRLCR292Y\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 2,\r\n            \"duration\": 109\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GY8RQ0QC2\",\r\n          \"name\": \"WahyuRini13\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 22,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GY9JQCJ8U\",\r\n            \"defenderTag\": \"#GY8RQ0QC2\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 5,\r\n            \"duration\": 141\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#Y90U2U829\",\r\n          \"name\": \"Milo\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 12,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#Y90U2U829\",\r\n              \"defenderTag\": \"#GPGLJPQ0U\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 52,\r\n              \"duration\": 59\r\n            },\r\n            {\r\n              \"attackerTag\": \"#Y90U2U829\",\r\n              \"defenderTag\": \"#G9YV2GJV8\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 86,\r\n              \"order\": 53,\r\n              \"duration\": 100\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GLYYCU2JG\",\r\n            \"defenderTag\": \"#Y90U2U829\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 20,\r\n            \"duration\": 103\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QV9UUCJP2\",\r\n          \"name\": \"RIDHY\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 16,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9YV2GJV8\",\r\n            \"defenderTag\": \"#QV9UUCJP2\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 13,\r\n            \"duration\": 77\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#2PVJPR0L\",\r\n          \"name\": \"Salma Cantik\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 1,\r\n          \"opponentAttacks\": 4,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#8G2PJJPQ9\",\r\n            \"defenderTag\": \"#2PVJPR0L\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 14,\r\n            \"duration\": 121\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GYC9G9L90\",\r\n          \"name\": \"NOOOOB player\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 25,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#9CJVUYQPY\",\r\n            \"defenderTag\": \"#GYC9G9L90\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 23,\r\n            \"duration\": 59\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QU8U998QR\",\r\n          \"name\": \"Mangkupurel\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 4,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GYQRJGGCQ\",\r\n            \"defenderTag\": \"#QU8U998QR\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 25,\r\n            \"duration\": 126\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G2GQC0Y90\",\r\n          \"name\": \"MARUPA5\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 23,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#9CJVUYQPY\",\r\n            \"defenderTag\": \"#G2GQC0Y90\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 22,\r\n            \"duration\": 70\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QVRY0PG9V\",\r\n          \"name\": \"artic?\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 24,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#QVRY0PG9V\",\r\n              \"defenderTag\": \"#GY9JQCJ8U\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 32,\r\n              \"duration\": 112\r\n            },\r\n            {\r\n              \"attackerTag\": \"#QVRY0PG9V\",\r\n              \"defenderTag\": \"#G9Y8JQP80\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 33,\r\n              \"duration\": 144\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GY9JQCJ8U\",\r\n            \"defenderTag\": \"#QVRY0PG9V\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 4,\r\n            \"duration\": 106\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    \"status_code\": 200,\r\n    \"timestamp\": 1704079537.264265,\r\n    \"_response_retry\": 118\r\n  },\r\n  {\r\n    \"state\": \"warEnded\",\r\n    \"teamSize\": 20,\r\n    \"attacksPerMember\": 2,\r\n    \"preparationStartTime\": \"20231227T081509.000Z\",\r\n    \"startTime\": \"20231228T071509.000Z\",\r\n    \"endTime\": \"20231229T071509.000Z\",\r\n    \"clan\": {\r\n      \"tag\": \"#2GPG90QRU\",\r\n      \"name\": \"Madaripur TM\",\r\n      \"badgeUrls\": {\r\n        \"small\": \"https://api-assets.clashofclans.com/badges/70/w7GqFYoI2JfKZjFiWQ2k_j4jUPJKLPX4I2ltOMg7xs8.png\",\r\n        \"large\": \"https://api-assets.clashofclans.com/badges/512/w7GqFYoI2JfKZjFiWQ2k_j4jUPJKLPX4I2ltOMg7xs8.png\",\r\n        \"medium\": \"https://api-assets.clashofclans.com/badges/200/w7GqFYoI2JfKZjFiWQ2k_j4jUPJKLPX4I2ltOMg7xs8.png\"\r\n      },\r\n      \"clanLevel\": 3,\r\n      \"attacks\": 3,\r\n      \"stars\": 8,\r\n      \"destructionPercentage\": 13.85,\r\n      \"members\": [\r\n        {\r\n          \"tag\": \"#G099GCJJV\",\r\n          \"name\": \"al\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 19,\r\n          \"opponentAttacks\": 3,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G8GQR0GY9\",\r\n            \"defenderTag\": \"#G099GCJJV\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 23,\r\n            \"duration\": 74\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QQ8UVU2LP\",\r\n          \"name\": \"partha piu\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 12,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9QPLQ00J\",\r\n            \"defenderTag\": \"#QQ8UVU2LP\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 16,\r\n            \"duration\": 134\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G8GQJQPP2\",\r\n          \"name\": \"pugal7\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 8,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QLPG2LJ8P\",\r\n            \"defenderTag\": \"#G8GQJQPP2\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 5,\r\n            \"duration\": 108\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G0G0UYPU8\",\r\n          \"name\": \"jemi\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 13,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GLYYCU2JG\",\r\n            \"defenderTag\": \"#G0G0UYPU8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 19,\r\n            \"duration\": 108\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#8GC9C08GU\",\r\n          \"name\": \"★★♥MOON♥★★\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 10,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#8G2PJJPQ9\",\r\n            \"defenderTag\": \"#8GC9C08GU\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 10,\r\n            \"duration\": 117\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#L09PL0Q82\",\r\n          \"name\": \"ju6nitoo\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 6,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#8G2PJJPQ9\",\r\n            \"defenderTag\": \"#L09PL0Q82\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 7,\r\n            \"duration\": 112\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G9CVCPCR8\",\r\n          \"name\": \"lelu\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 14,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G08UGPLLY\",\r\n            \"defenderTag\": \"#G9CVCPCR8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 17,\r\n            \"duration\": 113\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GPQ0JL0QV\",\r\n          \"name\": \"fnorzz\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 18,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9YV2GJV8\",\r\n            \"defenderTag\": \"#GPQ0JL0QV\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 22,\r\n            \"duration\": 86\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#LGPP9UUCR\",\r\n          \"name\": \"NARUTO UZUMAKI\",\r\n          \"townhallLevel\": 13,\r\n          \"mapPosition\": 1,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#LGPP9UUCR\",\r\n              \"defenderTag\": \"#P200GRQJ\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 33,\r\n              \"duration\": 129\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 3,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G28CPC2Y\",\r\n            \"defenderTag\": \"#LGPP9UUCR\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 26,\r\n            \"duration\": 123\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#YPR88PYL0\",\r\n          \"name\": \"ABHIJOT WARRING\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 2,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G28CPC2Y\",\r\n            \"defenderTag\": \"#YPR88PYL0\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 25,\r\n            \"duration\": 63\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#LCP98VGG9\",\r\n          \"name\": \"Brokenbottle\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 5,\r\n          \"opponentAttacks\": 3,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LV89GV88Y\",\r\n            \"defenderTag\": \"#LCP98VGG9\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 1,\r\n            \"duration\": 113\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QU2PRGV9L\",\r\n          \"name\": \"bob\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 7,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LV89GV88Y\",\r\n            \"defenderTag\": \"#QU2PRGV9L\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 4,\r\n            \"duration\": 97\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#GYUY02GGV\",\r\n          \"name\": \"Chayon das RE\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 11,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GLYYCU2JG\",\r\n            \"defenderTag\": \"#GYUY02GGV\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 13,\r\n            \"duration\": 100\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#YCYRLJQU8\",\r\n          \"name\": \"BoxIsASquare_2\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 15,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G08UGPLLY\",\r\n            \"defenderTag\": \"#YCYRLJQU8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 18,\r\n            \"duration\": 110\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#YVYJ0CUCU\",\r\n          \"name\": \"DEMON\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 17,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9Y8JQP80\",\r\n            \"defenderTag\": \"#YVYJ0CUCU\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 21,\r\n            \"duration\": 108\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QYP9LR0YC\",\r\n          \"name\": \"ryuga\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 9,\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QLPG2LJ8P\",\r\n            \"defenderTag\": \"#QYP9LR0YC\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 6,\r\n            \"duration\": 114\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#QJ2CPC2R8\",\r\n          \"name\": \"Joy\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 3,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#QJ2CPC2R8\",\r\n              \"defenderTag\": \"#G28CPC2Y\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 11,\r\n              \"duration\": 130\r\n            },\r\n            {\r\n              \"attackerTag\": \"#QJ2CPC2R8\",\r\n              \"defenderTag\": \"#80LJQ8V9L\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 77,\r\n              \"order\": 12,\r\n              \"duration\": 136\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 2,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#80LJQ8V9L\",\r\n            \"defenderTag\": \"#QJ2CPC2R8\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 9,\r\n            \"duration\": 71\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G0VCCLVR9\",\r\n          \"name\": \"thetnaing\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 4,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GUV292VJ\",\r\n            \"defenderTag\": \"#G0VCCLVR9\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 14,\r\n            \"duration\": 104\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G8GU2982Q\",\r\n          \"name\": \"Ly Tho\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 20,\r\n          \"opponentAttacks\": 3,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#GPGLJPQ0U\",\r\n            \"defenderTag\": \"#G8GU2982Q\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 2,\r\n            \"duration\": 98\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G0RCJ09RU\",\r\n          \"name\": \"jisan ahmed\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 16,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#G9Y8JQP80\",\r\n            \"defenderTag\": \"#G0RCJ09RU\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 20,\r\n            \"duration\": 117\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    \"opponent\": {\r\n      \"tag\": \"#2G2LJUYGV\",\r\n      \"name\": \"Zen Seekers\",\r\n      \"badgeUrls\": {\r\n        \"small\": \"https://api-assets.clashofclans.com/badges/70/8WhutCWKrbciJps9ktkcdEoYIo0QLnFN3AHPnpGP0hA.png\",\r\n        \"large\": \"https://api-assets.clashofclans.com/badges/512/8WhutCWKrbciJps9ktkcdEoYIo0QLnFN3AHPnpGP0hA.png\",\r\n        \"medium\": \"https://api-assets.clashofclans.com/badges/200/8WhutCWKrbciJps9ktkcdEoYIo0QLnFN3AHPnpGP0hA.png\"\r\n      },\r\n      \"clanLevel\": 7,\r\n      \"attacks\": 34,\r\n      \"stars\": 60,\r\n      \"destructionPercentage\": 100,\r\n      \"members\": [\r\n        {\r\n          \"tag\": \"#8G2PJJPQ9\",\r\n          \"name\": \"Green Arrow\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 7,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#8G2PJJPQ9\",\r\n              \"defenderTag\": \"#L09PL0Q82\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 7,\r\n              \"duration\": 112\r\n            },\r\n            {\r\n              \"attackerTag\": \"#8G2PJJPQ9\",\r\n              \"defenderTag\": \"#8GC9C08GU\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 10,\r\n              \"duration\": 117\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#29R0VGQU\",\r\n          \"name\": \"FlameArcher\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 6,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#29R0VGQU\",\r\n              \"defenderTag\": \"#LCP98VGG9\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 27,\r\n              \"duration\": 80\r\n            },\r\n            {\r\n              \"attackerTag\": \"#29R0VGQU\",\r\n              \"defenderTag\": \"#QU2PRGV9L\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 29,\r\n              \"duration\": 101\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G28CPC2Y\",\r\n          \"name\": \"Cuba II\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 2,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G28CPC2Y\",\r\n              \"defenderTag\": \"#YPR88PYL0\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 25,\r\n              \"duration\": 63\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G28CPC2Y\",\r\n              \"defenderTag\": \"#LGPP9UUCR\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 26,\r\n              \"duration\": 123\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QJ2CPC2R8\",\r\n            \"defenderTag\": \"#G28CPC2Y\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 11,\r\n            \"duration\": 130\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G8GQR0GY9\",\r\n          \"name\": \"Cuba III\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 12,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G8GQR0GY9\",\r\n              \"defenderTag\": \"#G099GCJJV\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 23,\r\n              \"duration\": 74\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G8GQR0GY9\",\r\n              \"defenderTag\": \"#LCP98VGG9\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 24,\r\n              \"duration\": 125\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GUV292VJ\",\r\n          \"name\": \"TA15\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 5,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GUV292VJ\",\r\n              \"defenderTag\": \"#G0VCCLVR9\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 14,\r\n              \"duration\": 104\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GUV292VJ\",\r\n              \"defenderTag\": \"#YPR88PYL0\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 83,\r\n              \"order\": 15,\r\n              \"duration\": 126\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GP9UVLUJ2\",\r\n          \"name\": \"Yaspox\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 17,\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#LV89GV88Y\",\r\n          \"name\": \"Warrior₩Th9\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 8,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#LV89GV88Y\",\r\n              \"defenderTag\": \"#LCP98VGG9\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 1,\r\n              \"duration\": 113\r\n            },\r\n            {\r\n              \"attackerTag\": \"#LV89GV88Y\",\r\n              \"defenderTag\": \"#QU2PRGV9L\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 4,\r\n              \"duration\": 97\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#QLPG2LJ8P\",\r\n          \"name\": \"Warrior\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 13,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#QLPG2LJ8P\",\r\n              \"defenderTag\": \"#G8GQJQPP2\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 5,\r\n              \"duration\": 108\r\n            },\r\n            {\r\n              \"attackerTag\": \"#QLPG2LJ8P\",\r\n              \"defenderTag\": \"#QYP9LR0YC\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 6,\r\n              \"duration\": 114\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GPGLJPQ0U\",\r\n          \"name\": \"LagApprentice⚡\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 20,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GPGLJPQ0U\",\r\n              \"defenderTag\": \"#G8GU2982Q\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 2,\r\n              \"duration\": 98\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GPGLJPQ0U\",\r\n              \"defenderTag\": \"#G099GCJJV\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 83,\r\n              \"order\": 3,\r\n              \"duration\": 180\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#YPQ2UJUQR\",\r\n          \"name\": \"BumblinMumbler2\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 16,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#YPQ2UJUQR\",\r\n              \"defenderTag\": \"#QQ8UVU2LP\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 30,\r\n              \"duration\": 113\r\n            },\r\n            {\r\n              \"attackerTag\": \"#YPQ2UJUQR\",\r\n              \"defenderTag\": \"#QYP9LR0YC\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 31,\r\n              \"duration\": 142\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G20P2J9CC\",\r\n          \"name\": \"Deus_seeker\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 15,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G20P2J9CC\",\r\n              \"defenderTag\": \"#G099GCJJV\",\r\n              \"stars\": 0,\r\n              \"destructionPercentage\": 0,\r\n              \"order\": 36,\r\n              \"duration\": 0\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G20P2J9CC\",\r\n              \"defenderTag\": \"#G8GU2982Q\",\r\n              \"stars\": 0,\r\n              \"destructionPercentage\": 0,\r\n              \"order\": 37,\r\n              \"duration\": 0\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G9QPLQ00J\",\r\n          \"name\": \"Electric Wizard\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 9,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9QPLQ00J\",\r\n              \"defenderTag\": \"#QQ8UVU2LP\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 16,\r\n              \"duration\": 134\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9QPLQ00J\",\r\n              \"defenderTag\": \"#LGPP9UUCR\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 51,\r\n              \"order\": 28,\r\n              \"duration\": 100\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#80LJQ8V9L\",\r\n          \"name\": \"Stokjeeeee\",\r\n          \"townhallLevel\": 11,\r\n          \"mapPosition\": 1,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#80LJQ8V9L\",\r\n              \"defenderTag\": \"#LGPP9UUCR\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 86,\r\n              \"order\": 8,\r\n              \"duration\": 112\r\n            },\r\n            {\r\n              \"attackerTag\": \"#80LJQ8V9L\",\r\n              \"defenderTag\": \"#QJ2CPC2R8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 9,\r\n              \"duration\": 71\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#QJ2CPC2R8\",\r\n            \"defenderTag\": \"#80LJQ8V9L\",\r\n            \"stars\": 2,\r\n            \"destructionPercentage\": 77,\r\n            \"order\": 12,\r\n            \"duration\": 136\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G80YGVYPP\",\r\n          \"name\": \"Deusloveswar\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 4,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G80YGVYPP\",\r\n              \"defenderTag\": \"#QJ2CPC2R8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 34,\r\n              \"duration\": 111\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G80YGVYPP\",\r\n              \"defenderTag\": \"#G8GU2982Q\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 35,\r\n              \"duration\": 88\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#GLYYCU2JG\",\r\n          \"name\": \"asgaR0R\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 14,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#GLYYCU2JG\",\r\n              \"defenderTag\": \"#GYUY02GGV\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 13,\r\n              \"duration\": 100\r\n            },\r\n            {\r\n              \"attackerTag\": \"#GLYYCU2JG\",\r\n              \"defenderTag\": \"#G0G0UYPU8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 19,\r\n              \"duration\": 108\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#P200GRQJ\",\r\n          \"name\": \"firebird 2.0\",\r\n          \"townhallLevel\": 10,\r\n          \"mapPosition\": 3,\r\n          \"opponentAttacks\": 1,\r\n          \"bestOpponentAttack\": {\r\n            \"attackerTag\": \"#LGPP9UUCR\",\r\n            \"defenderTag\": \"#P200GRQJ\",\r\n            \"stars\": 3,\r\n            \"destructionPercentage\": 100,\r\n            \"order\": 33,\r\n            \"duration\": 129\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"#G9YV2GJV8\",\r\n          \"name\": \"ShinE\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 18,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9YV2GJV8\",\r\n              \"defenderTag\": \"#GPQ0JL0QV\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 22,\r\n              \"duration\": 86\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9YV2GJV8\",\r\n              \"defenderTag\": \"#GYUY02GGV\",\r\n              \"stars\": 2,\r\n              \"destructionPercentage\": 93,\r\n              \"order\": 32,\r\n              \"duration\": 180\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#9CJVUYQPY\",\r\n          \"name\": \"red mastachio\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 10,\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G08UGPLLY\",\r\n          \"name\": \"Ryan\",\r\n          \"townhallLevel\": 9,\r\n          \"mapPosition\": 11,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G08UGPLLY\",\r\n              \"defenderTag\": \"#G9CVCPCR8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 17,\r\n              \"duration\": 113\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G08UGPLLY\",\r\n              \"defenderTag\": \"#YCYRLJQU8\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 18,\r\n              \"duration\": 110\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        },\r\n        {\r\n          \"tag\": \"#G9Y8JQP80\",\r\n          \"name\": \"treehunter\",\r\n          \"townhallLevel\": 8,\r\n          \"mapPosition\": 19,\r\n          \"attacks\": [\r\n            {\r\n              \"attackerTag\": \"#G9Y8JQP80\",\r\n              \"defenderTag\": \"#G0RCJ09RU\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 20,\r\n              \"duration\": 117\r\n            },\r\n            {\r\n              \"attackerTag\": \"#G9Y8JQP80\",\r\n              \"defenderTag\": \"#YVYJ0CUCU\",\r\n              \"stars\": 3,\r\n              \"destructionPercentage\": 100,\r\n              \"order\": 21,\r\n              \"duration\": 108\r\n            }\r\n          ],\r\n          \"opponentAttacks\": 0\r\n        }\r\n      ]\r\n    },\r\n    \"status_code\": 200,\r\n    \"timestamp\": 1703834115.600175,\r\n    \"_response_retry\": 120\r\n  },\r\n]";
        public ClashKingApiClient() 
        {
            _httpClient = new HttpClient();
            _httpClient.BaseAddress = new Uri("https://api.clashking.xyz/");
            _httpClient.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
            _httpClient.DefaultRequestHeaders.UserAgent.Add(new ProductInfoHeaderValue("ZenBot", null));
        }

        public async Task<IEnumerable<string>> PostDiscordLinksAsync(ulong userId)
        {
            UriBuilder uriBuilder = new UriBuilder();
            try
            {
                uriBuilder.Host = _httpClient.BaseAddress!.Host;
                uriBuilder.Scheme = _httpClient.BaseAddress.Scheme;
                uriBuilder.Port = _httpClient.BaseAddress.Port;
                uriBuilder.Path = $"/discord_links";
            }
            catch
            {
                // TODO
                Console.WriteLine();
            }
            return Array.Empty<string>();
        }

        public async Task GetClanWarHistory(string clanTag)
        {
            UriBuilder uriBuilder = new UriBuilder();
            try
            {
                uriBuilder.Host = _httpClient.BaseAddress!.Host;
                uriBuilder.Scheme = _httpClient.BaseAddress.Scheme;
                uriBuilder.Port = _httpClient.BaseAddress.Port;
                uriBuilder.Path = $"/war/{Uri.EscapeDataString(clanTag)}/previous";

                var response = await _httpClient.GetAsync(uriBuilder.Uri);
                response.EnsureSuccessStatusCode();
                var resultJson = await response.Content.ReadAsStringAsync();
                var warDataList = JsonConvert.DeserializeObject<List<WarData>>(resultJson);
            }
            catch (HttpRequestException e)
            {
                Console.WriteLine("\nException Caught!");
                Console.WriteLine("Message :{0} ", e.Message);
            }
        }

        public async Task<IEnumerable<WarAttack>> GetPlayerWarAttacksAsync(string playerTag)
        {
            UriBuilder uriBuilder = new UriBuilder();
            try
            {
                uriBuilder.Host = _httpClient.BaseAddress!.Host;
                uriBuilder.Scheme = _httpClient.BaseAddress.Scheme;
                uriBuilder.Port = _httpClient.BaseAddress.Port;
                uriBuilder.Path = $"/player/{Uri.EscapeDataString(playerTag)}/warhits";

                var response = await _httpClient.GetAsync(uriBuilder.Uri);
                response.EnsureSuccessStatusCode();
                var resultJson = await response.Content.ReadAsStringAsync();
                var warApiResponse = JsonConvert.DeserializeObject<WarApiResponse>(resultJson);
                return warApiResponse?.Attacks ?? [];
            }
            catch 
            {
                // TODO
                Console.WriteLine();
                return [];
            }
        }

        public class WarApiResponse
        {
            public List<WarAttack> Attacks { get; set; }
        }

        public class ClanWarsApiResponse
        {
            public List<ClanWar> ClanWars { get; set; }
        }


        public async Task<string> Test()
        {
            var requests = new string[]
            {
                "https://api.clashking.xyz/player/%23G28CPC2Y/warhits",
                "https://api.clashking.xyz/player/%23Y2VJ0YGC/warhits",
                "https://api.clashking.xyz/player/%23G8GQR0GY9/warhits",
            };
            var attackList = new List<WarAttack>();
            foreach (var request in requests)
            {
                var response = _httpClient.GetAsync(request).Result;
                var res = await response.Content.ReadAsStringAsync();
                attackList.AddRange(JsonConvert.DeserializeObject<List<WarAttack>>(res) ?? new List<WarAttack>());
            }

            List<Stat> statList = new();
            foreach(var warAttack in attackList.Where(a => a.WarType == "random"))
            {
                var stat = GetOrAdd(statList, warAttack.Townhall, warAttack.DefenderTownhall);
                stat.Count++;
                if (warAttack.Stars == 3)
                    stat.Success++;
            }

            statList = statList.OrderByDescending(s => s.ThFrom).ThenByDescending(s => s.ThTo).ToList();
            var sb = new StringBuilder("```\n");
            foreach(Stat stat in statList)
            {
                sb.AppendLine(stat.ToString());
            }
            sb.AppendLine("```");
            return sb.ToString();
        }

        private Stat GetOrAdd(List<Stat> list, int ThFrom, int ThTo)
        {
            var stat = list.FirstOrDefault(s => s.ThFrom == ThFrom && s.ThTo == ThTo);
            if(stat is null)
            {
                stat = new Stat(ThFrom, ThTo);
                list.Add(stat);
            }
            return stat;
        }

        private class Stat
        {
            public Stat(int thFrom, int thTo)
            {
                ThFrom = thFrom;
                ThTo = thTo;
            }

            public int ThFrom { get; set; }
            public int ThTo { get; set; }
            public int Success { get; set; }
            public int Count { get; set; }

            public override string ToString()
            {
                double percentage = (double)Success / Count;
                return $"{ThFrom}v{ThTo}:\t{Success}/{Count}\t{percentage.ToString("0%")}";
            }
        }
    }
    
    
}
